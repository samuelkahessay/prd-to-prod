@page "/"
@model IndexModel
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>prd-to-prod — autonomous software pipeline</title>
    <meta name="description" content="Drop a PRD, get a deployed app. Zero human code. An autonomous GitHub pipeline that decomposes requirements, writes code, reviews its own work, and ships." />
    <!-- OpenGraph -->
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="prd-to-prod" />
    <meta property="og:url" content="https://prd-to-prod.azurewebsites.net" />
    <meta property="og:title" content="prd-to-prod — Drop a PRD. Get a deployed app." />
    <meta property="og:description" content="Autonomous software pipeline: AI decomposes requirements → writes code → reviews PRs → ships to main. Zero human code." />
    <meta property="og:image" content="https://prd-to-prod.azurewebsites.net/og-image.png" />
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="prd-to-prod — Drop a PRD. Get a deployed app." />
    <meta name="twitter:description" content="Autonomous software pipeline: AI decomposes requirements → writes code → reviews PRs → ships to main. Zero human code." />
    <meta name="twitter:image" content="https://prd-to-prod.azurewebsites.net/og-image.png" />
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --bg: #080c12;
            --grid-line: rgba(0, 160, 255, 0.04);
            --border: rgba(0, 160, 255, 0.15);
            --accent: #00aaff;
            --accent-dim: rgba(0, 170, 255, 0.08);
            --green: #3ddc84;
            --amber: #f5a623;
            --red: #f85149;
            --text: #b8c4d4;
            --dim: #4a5a72;
            --mono: 'JetBrains Mono', monospace;
            --sans: 'Space Grotesk', sans-serif;
        }
        * { box-sizing: border-box; }
        body {
            background-color: var(--bg);
            background-image:
                linear-gradient(var(--grid-line) 1px, transparent 1px),
                linear-gradient(90deg, var(--grid-line) 1px, transparent 1px);
            background-size: 48px 48px;
            font-family: var(--mono);
            color: var(--text);
            font-size: 14px;
        }
        h1, h2, h3, .font-sans { font-family: var(--sans); }
        .status-bar {
            background: rgba(0, 170, 255, 0.04);
            border-bottom: 1px solid var(--border);
        }
        .panel {
            background: rgba(4, 10, 20, 0.7);
            border: 1px solid var(--border);
        }
        .panel-top {
            border-top: 2px solid var(--accent);
        }
        .metric-val {
            font-family: var(--mono);
            color: var(--accent);
            font-size: 1.75rem;
            font-weight: 700;
            line-height: 1;
        }
        .metric-lbl {
            color: var(--dim);
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            margin-top: 6px;
        }
        .exec-btn {
            background: transparent;
            border: 1px solid var(--accent);
            color: var(--accent);
            font-family: var(--mono);
            font-size: 1rem;
            font-weight: 700;
            padding: 14px 48px;
            cursor: pointer;
            transition: background 0.2s, box-shadow 0.2s;
            letter-spacing: 0.05em;
        }
        .exec-btn:hover {
            background: var(--accent-dim);
            box-shadow: 0 0 24px rgba(0, 170, 255, 0.2), inset 0 0 20px rgba(0, 170, 255, 0.04);
        }
        .exec-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .stage-label {
            color: var(--dim);
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            width: 60px;
            flex-shrink: 0;
            padding-top: 2px;
        }
        .flow-tag {
            background: rgba(0, 170, 255, 0.08);
            border: 1px solid var(--border);
            color: var(--text);
            font-family: var(--mono);
            font-size: 0.7rem;
            padding: 3px 10px;
            white-space: nowrap;
        }
        .flow-tag-green {
            background: rgba(61, 220, 132, 0.08);
            border: 1px solid rgba(61, 220, 132, 0.2);
            color: var(--green);
        }
        .flow-tag-amber {
            background: rgba(245, 166, 35, 0.08);
            border: 1px solid rgba(245, 166, 35, 0.2);
            color: var(--amber);
        }
        @@keyframes cursor-blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }
        .cursor-blink {
            animation: cursor-blink 1s step-end infinite;
            color: var(--accent);
        }
        .divider { border-top: 1px solid var(--border); margin: 0; }
        .text-accent { color: var(--accent); }
        .text-green { color: var(--green); }
        .text-amber { color: var(--amber); }
        .text-dim { color: var(--dim); }
        .text-white { color: #e8edf5; }
    </style>
</head>
<body class="min-h-screen">

    <!-- Status bar -->
    <div class="status-bar px-6 py-2 flex items-center justify-between text-xs">
        <div class="flex items-center gap-4">
            <span class="text-accent font-bold tracking-widest">PRD-TO-PROD</span>
            <span class="text-dim">//</span>
            <span class="text-dim"><a href="https://github.com/samuelkahessay/prd-to-prod" target="_blank" rel="noopener noreferrer" class="text-dim hover:text-accent transition-colors">samuelkahessay/prd-to-prod</a></span>
        </div>
        <div class="flex items-center gap-2">
            <span class="w-2 h-2 rounded-full bg-[var(--green)] inline-block"></span>
            <span class="text-dim">pipeline: active</span>
        </div>
    </div>

    <div class="max-w-4xl mx-auto px-4 py-14">

        <!-- Hero -->
        <section class="mb-16">
            <div class="text-xs text-dim mb-5">// autonomous software factory — powered by gh-aw</div>
            <h1 class="font-sans text-5xl sm:text-6xl font-bold text-white mb-4 leading-tight">
                Drop a PRD.<br />Get a deployed app.
            </h1>
            <p class="text-dim text-base mb-6">Zero human code.<span class="cursor-blink ml-1">█</span></p>
            <p class="text-sm leading-relaxed max-w-2xl mb-8" style="color: var(--text)">
                <a href="https://github.com/samuelkahessay/prd-to-prod" target="_blank" rel="noopener noreferrer" class="text-accent font-bold hover:underline">prd-to-prod</a> is an autonomous software pipeline powered by
                <a href="https://github.com/github/gh-aw" target="_blank" rel="noopener noreferrer" class="text-accent font-bold hover:underline">gh-aw</a> (GitHub Agentic Workflows).
                It reads a product requirements document, decomposes it into GitHub Issues,
                writes code for each one, opens Pull Requests, reviews its own work, merges to main —
                and self-heals when things break. No human writes a single line of code.
            </p>
            <a href="https://github.com/samuelkahessay/prd-to-prod" target="_blank" rel="noopener noreferrer" class="exec-btn inline-block" style="text-decoration: none; display: inline-block;">[ View on GitHub ]</a>
        </section>

        <!-- Pipeline schematic -->
        <section class="mb-16">
            <div class="text-xs text-dim mb-5 uppercase tracking-widest">// system schematic — prd-to-prod pipeline</div>
            <div class="panel p-6">
                <div class="flex flex-col gap-5">

                    <div class="flex gap-4 items-start">
                        <span class="stage-label">INPUT</span>
                        <div>
                            <div class="text-accent text-xs mb-1">[ product-requirements.md ]</div>
                            <div class="text-dim text-xs leading-relaxed">"Build a ticket deflection service with classification, KB matching, and a live dashboard..."</div>
                        </div>
                    </div>

                    <div class="divider"></div>

                    <div class="flex gap-4 items-start">
                        <span class="stage-label">STAGE 1</span>
                        <div>
                            <div class="text-white font-bold text-sm mb-1">prd-decomposer</div>
                            <div class="text-dim text-xs">Reads PRD → creates GitHub Issues with acceptance criteria and dependency graph</div>
                            <div class="text-green text-xs mt-1">&gt; 13 issues created</div>
                        </div>
                    </div>

                    <div class="flex gap-4 items-start">
                        <span class="stage-label">STAGE 2</span>
                        <div>
                            <div class="text-white font-bold text-sm mb-1">repo-assist</div>
                            <div class="text-dim text-xs">Picks up each issue in dependency order, writes code, opens one draft Pull Request per issue</div>
                            <div class="text-green text-xs mt-1">&gt; 13 PRs opened</div>
                        </div>
                    </div>

                    <div class="flex gap-4 items-start">
                        <span class="stage-label">STAGE 3</span>
                        <div>
                            <div class="text-white font-bold text-sm mb-1">pr-review-agent</div>
                            <div class="text-dim text-xs">Reads full codebase and PR diff, posts verdict — APPROVE or REQUEST_CHANGES with remediation steps</div>
                            <div class="text-green text-xs mt-1">&gt; 13 reviews submitted</div>
                        </div>
                    </div>

                    <div class="flex gap-4 items-start">
                        <span class="stage-label">STAGE 4</span>
                        <div>
                            <div class="text-white font-bold text-sm mb-1">pr-review-submit + auto-merge</div>
                            <div class="text-dim text-xs">On APPROVE: enables auto-merge → PR merges to main → linked issue closes automatically</div>
                            <div class="text-green text-xs mt-1">&gt; 13 PRs merged to main</div>
                        </div>
                    </div>

                    <div class="divider"></div>

                    <div class="flex gap-4 items-start">
                        <span class="stage-label">OUTPUT</span>
                        <div>
                            <div class="text-accent text-xs mb-1">[ production-ready application ]</div>
                            <div class="text-dim text-xs">C#/.NET 10 · ASP.NET Core · Razor Pages · EF Core · xUnit · Dockerfile</div>
                        </div>
                    </div>

                </div>
            </div>
            <div class="mt-3 text-xs text-dim">
                <span class="text-accent">Self-healing:</span> pipeline-watchdog detects stalls, retries failures, cleans up superseded PRs. No human intervention required.
            </div>
        </section>

        <!-- Run History -->
        <section class="mb-16">
            <div class="text-xs text-dim mb-1 uppercase tracking-widest">// build manifest — pipeline run history</div>
            <div class="text-xs font-bold mb-5 text-accent">4 runs · 4 apps · 3 tech stacks · 50+ issues · 61+ PRs · zero human code</div>
            <div class="panel overflow-hidden">
                <!-- Column headers (desktop) -->
                <div class="hidden sm:grid px-4 py-2 text-xs" style="grid-template-columns: 44px 1fr 1fr 60px 60px 72px; border-bottom: 1px solid var(--border); color: var(--dim);">
                    <span>RUN</span>
                    <span>CODENAME</span>
                    <span>STACK</span>
                    <span class="text-right">ISSUES</span>
                    <span class="text-right">PRS</span>
                    <span class="text-right">STATUS</span>
                </div>

                <!-- Run 04 — ACTIVE -->
                <div class="px-4 py-4" style="border-bottom: 1px solid rgba(0,170,255,0.08); background: rgba(0,170,255,0.03);">
                    <!-- desktop row -->
                    <div class="hidden sm:grid text-xs items-start" style="grid-template-columns: 44px 1fr 1fr 60px 60px 72px;">
                        <span class="text-accent font-bold pt-0.5">04</span>
                        <div>
                            <div class="text-white font-bold">Ticket Deflection Service</div>
                            <div class="text-dim text-xs mt-1">this instance · <a href="https://github.com/samuelkahessay/prd-to-prod/tree/main" class="text-accent hover:underline">main</a></div>
                        </div>
                        <div class="text-dim leading-relaxed">C# / .NET 10<br />ASP.NET Core / Razor Pages<br />EF Core / xUnit</div>
                        <span class="text-accent text-right font-bold">13</span>
                        <span class="text-accent text-right font-bold">13</span>
                        <div class="text-right"><span class="text-green font-bold">ACTIVE</span></div>
                    </div>
                    <!-- mobile -->
                    <div class="sm:hidden">
                        <div class="flex items-center justify-between mb-1">
                            <span class="text-accent font-bold text-xs">RUN 04</span>
                            <span class="text-green font-bold text-xs">ACTIVE</span>
                        </div>
                        <div class="text-white font-bold text-sm">Ticket Deflection Service</div>
                        <div class="text-dim text-xs mt-1">C# / .NET 10 / ASP.NET Core / EF Core</div>
                        <div class="text-xs mt-1"><span class="text-dim">13 issues · 13 PRs</span> · <a href="https://github.com/samuelkahessay/prd-to-prod/tree/main" class="text-accent hover:underline">main</a></div>
                    </div>
                </div>

                <!-- Run 03 -->
                <div class="px-4 py-4" style="border-bottom: 1px solid var(--border);">
                    <div class="hidden sm:grid text-xs items-start" style="grid-template-columns: 44px 1fr 1fr 60px 60px 72px;">
                        <span class="text-dim font-bold pt-0.5">03</span>
                        <div>
                            <div class="text-white font-bold">DevCard</div>
                            <div class="text-dim text-xs mt-1"><a href="https://github.com/samuelkahessay/prd-to-prod/tree/v3.0.0" class="hover:text-accent transition-colors">v3.0.0</a></div>
                        </div>
                        <div class="text-dim leading-relaxed">Next.js 14 / TypeScript<br />Tailwind CSS / Framer Motion<br />29 tests · 6 themes</div>
                        <span class="text-dim text-right">17</span>
                        <span class="text-dim text-right">22</span>
                        <div class="text-right text-dim">merged</div>
                    </div>
                    <div class="sm:hidden">
                        <div class="flex items-center justify-between mb-1">
                            <span class="text-dim font-bold text-xs">RUN 03</span>
                            <span class="text-dim text-xs">merged</span>
                        </div>
                        <div class="text-white font-bold text-sm">DevCard</div>
                        <div class="text-dim text-xs mt-1">Next.js 14 / TypeScript / Tailwind CSS</div>
                        <div class="text-xs mt-1"><span class="text-dim">17 issues · 22 PRs</span> · <a href="https://github.com/samuelkahessay/prd-to-prod/tree/v3.0.0" class="hover:text-accent transition-colors text-dim">v3.0.0</a></div>
                    </div>
                </div>

                <!-- Run 02 -->
                <div class="px-4 py-4" style="border-bottom: 1px solid var(--border);">
                    <div class="hidden sm:grid text-xs items-start" style="grid-template-columns: 44px 1fr 1fr 60px 60px 72px;">
                        <span class="text-dim font-bold pt-0.5">02</span>
                        <div>
                            <div class="text-white font-bold">Pipeline Observatory</div>
                            <div class="text-dim text-xs mt-1"><a href="https://github.com/samuelkahessay/prd-to-prod/tree/v2.0.0" class="hover:text-accent transition-colors">v2.0.0</a></div>
                        </div>
                        <div class="text-dim leading-relaxed">Next.js 14 / TypeScript<br />Tailwind CSS / Framer Motion<br />32 tests</div>
                        <span class="text-dim text-right">12</span>
                        <span class="text-dim text-right">19</span>
                        <div class="text-right text-dim">merged</div>
                    </div>
                    <div class="sm:hidden">
                        <div class="flex items-center justify-between mb-1">
                            <span class="text-dim font-bold text-xs">RUN 02</span>
                            <span class="text-dim text-xs">merged</span>
                        </div>
                        <div class="text-white font-bold text-sm">Pipeline Observatory</div>
                        <div class="text-dim text-xs mt-1">Next.js 14 / TypeScript / Tailwind CSS</div>
                        <div class="text-xs mt-1"><span class="text-dim">12 issues · 19 PRs</span> · <a href="https://github.com/samuelkahessay/prd-to-prod/tree/v2.0.0" class="hover:text-accent transition-colors text-dim">v2.0.0</a></div>
                    </div>
                </div>

                <!-- Run 01 -->
                <div class="px-4 py-4">
                    <div class="hidden sm:grid text-xs items-start" style="grid-template-columns: 44px 1fr 1fr 60px 60px 72px;">
                        <span class="text-dim font-bold pt-0.5">01</span>
                        <div>
                            <div class="text-white font-bold">Code Snippet Manager</div>
                            <div class="text-dim text-xs mt-1"><a href="https://github.com/samuelkahessay/prd-to-prod/tree/v1.0.0" class="hover:text-accent transition-colors">v1.0.0</a></div>
                        </div>
                        <div class="text-dim leading-relaxed">Express / TypeScript<br />EJS / REST<br />first end-to-end run</div>
                        <span class="text-dim text-right">8</span>
                        <span class="text-dim text-right">7</span>
                        <div class="text-right text-dim">merged</div>
                    </div>
                    <div class="sm:hidden">
                        <div class="flex items-center justify-between mb-1">
                            <span class="text-dim font-bold text-xs">RUN 01</span>
                            <span class="text-dim text-xs">merged</span>
                        </div>
                        <div class="text-white font-bold text-sm">Code Snippet Manager</div>
                        <div class="text-dim text-xs mt-1">Express / TypeScript / EJS</div>
                        <div class="text-xs mt-1"><span class="text-dim">8 issues · 7 PRs</span> · <a href="https://github.com/samuelkahessay/prd-to-prod/tree/v1.0.0" class="hover:text-accent transition-colors text-dim">v1.0.0</a></div>
                    </div>
                </div>
            </div>
            <div class="mt-3 text-xs text-dim">
                Runs 01–03: git tags are the source of truth — inspect the full commit history at each tag link above.
            </div>
        </section>

        <!-- Replay -->
        <section class="mb-16" id="replay-section">
            <div class="text-xs text-dim mb-1 uppercase tracking-widest">// run replay — step through a completed pipeline run</div>
            <div class="text-xs text-dim mb-5">Select a run to inspect its timeline event-by-event.</div>
            <div class="panel p-4">
                <!-- Run selector -->
                <div class="mb-4">
                    <label class="text-xs text-dim uppercase tracking-widest block mb-2">Select run:</label>
                    <div id="run-selector" class="flex flex-wrap gap-2">
                        @foreach (var run in Model.CompletedRuns.OrderByDescending(r => r.Number))
                        {
                            <button
                                class="run-select-btn text-xs px-3 py-1.5 border border-border text-dim hover:text-accent hover:border-accent transition-colors"
                                style="border-color: var(--border); font-family: var(--mono);"
                                data-slug="@run.Slug">
                                @run.Number.ToString("D2") · @run.Name
                            </button>
                        }
                    </div>
                </div>

                <!-- No-selection state -->
                <div id="replay-empty" class="text-dim text-xs py-6">No replay selected — choose a run above to begin.</div>

                <!-- Replay pane (hidden until run selected) -->
                <div id="replay-pane" class="hidden">
                    <!-- Run meta -->
                    <div id="run-meta" class="mb-4 text-xs grid grid-cols-2 sm:grid-cols-4 gap-3"></div>

                    <!-- Step controls -->
                    <div class="flex items-center gap-3 mb-4">
                        <button id="btn-prev" class="exec-btn text-xs px-4 py-1.5" style="font-size:0.75rem; padding:6px 18px;" disabled>&#8592; Prev</button>
                        <span id="step-counter" class="text-dim text-xs"></span>
                        <button id="btn-next" class="exec-btn text-xs px-4 py-1.5" style="font-size:0.75rem; padding:6px 18px;">Next &#8594;</button>
                    </div>

                    <!-- Detail panel -->
                    <div id="event-detail" class="panel p-3 mb-4 text-xs hidden">
                        <div class="flex items-start gap-3">
                            <span id="detail-badge" class="px-2 py-0.5 text-xs font-bold" style="background: rgba(0,170,255,0.1); border: 1px solid var(--border); color: var(--accent); white-space: nowrap;"></span>
                            <div>
                                <div id="detail-title" class="text-white font-bold mb-1"></div>
                                <div id="detail-meta" class="text-dim"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Timeline list -->
                    <div id="timeline-list" class="space-y-1 max-h-64 overflow-y-auto pr-1"></div>
                </div>

                <!-- Loading state -->
                <div id="replay-loading" class="hidden text-dim text-xs py-4">Loading timeline...</div>

                <!-- Error state -->
                <div id="replay-error" class="hidden text-red-400 text-xs py-4"></div>
            </div>
        </section>

        <script>
        (function () {
            var state = { runs: [], events: [], current: -1 };

            var elEmpty   = document.getElementById('replay-empty');
            var elPane    = document.getElementById('replay-pane');
            var elLoading = document.getElementById('replay-loading');
            var elError   = document.getElementById('replay-error');
            var elMeta    = document.getElementById('run-meta');
            var elList    = document.getElementById('timeline-list');
            var elDetail  = document.getElementById('event-detail');
            var elBadge   = document.getElementById('detail-badge');
            var elTitle   = document.getElementById('detail-title');
            var elMetaD   = document.getElementById('detail-meta');
            var elPrev    = document.getElementById('btn-prev');
            var elNext    = document.getElementById('btn-next');
            var elCounter = document.getElementById('step-counter');

            var eventColors = {
                issue_created: { bg: 'rgba(245,166,35,0.1)', border: 'rgba(245,166,35,0.3)', color: '#f5a623', label: 'ISSUE' },
                pr_opened:     { bg: 'rgba(0,170,255,0.08)', border: 'var(--border)',          color: 'var(--accent)', label: 'PR OPEN' },
                pr_reviewed:   { bg: 'rgba(61,220,132,0.08)', border: 'rgba(61,220,132,0.2)', color: '#3ddc84', label: 'REVIEW' },
                pr_merged:     { bg: 'rgba(61,220,132,0.15)', border: 'rgba(61,220,132,0.3)', color: '#3ddc84', label: 'MERGED' }
            };

            function colorFor(ev) {
                return eventColors[ev] || { bg: 'rgba(74,90,114,0.2)', border: 'var(--border)', color: 'var(--dim)', label: ev.toUpperCase() };
            }

            function show(el) { el.classList.remove('hidden'); }
            function hide(el) { el.classList.add('hidden'); }

            function renderMeta(run, stats) {
                elMeta.innerHTML = [
                    ['NAME', run.name],
                    ['STACK', run.tech_stack],
                    ['ISSUES', stats.issues_created],
                    ['LINES +', stats.lines_added.toLocaleString()]
                ].map(function(p) {
                    return '<div><div class="text-dim uppercase tracking-widest mb-0.5" style="font-size:0.6rem">' + p[0] + '</div>'
                         + '<div class="text-accent font-bold">' + p[1] + '</div></div>';
                }).join('');
            }

            function renderList(idx) {
                elList.innerHTML = state.events.map(function(ev, i) {
                    var c = colorFor(ev.event);
                    var active = (i === idx);
                    return '<div class="flex items-start gap-2 px-2 py-1.5 cursor-pointer event-row ' + (active ? 'selected-event' : '') + '" '
                         + 'style="' + (active ? 'background: rgba(0,170,255,0.07);' : '') + '" '
                         + 'data-idx="' + i + '">'
                         + '<span class="px-1.5 py-0.5 text-xs font-bold flex-shrink-0" style="background:' + c.bg + ';border:1px solid ' + c.border + ';color:' + c.color + ';font-size:0.6rem">' + c.label + '</span>'
                         + '<div class="min-w-0">'
                         + '<div class="text-white text-xs truncate">#' + ev.item + ' ' + ev.title + '</div>'
                         + '<div class="text-dim" style="font-size:0.65rem">' + new Date(ev.timestamp).toISOString().slice(0, 10) + '</div>'
                         + '</div></div>';
                }).join('');
                elList.querySelectorAll('.event-row').forEach(function(row) {
                    row.addEventListener('click', function() { goTo(parseInt(row.dataset.idx)); });
                });
            }

            function renderDetail(idx) {
                var ev = state.events[idx];
                if (!ev) { hide(elDetail); return; }
                var c = colorFor(ev.event);
                elBadge.textContent = c.label;
                elBadge.style.cssText = 'background:' + c.bg + ';border:1px solid ' + c.border + ';color:' + c.color + ';padding:2px 8px;font-size:0.7rem;white-space:nowrap;';
                elTitle.textContent = '#' + ev.item + ' ' + ev.title;
                elMetaD.textContent = new Date(ev.timestamp).toUTCString();
                show(elDetail);
            }

            function goTo(idx) {
                state.current = idx;
                elPrev.disabled = (idx <= 0);
                elNext.disabled = (idx >= state.events.length - 1);
                elCounter.textContent = 'Event ' + (idx + 1) + ' of ' + state.events.length;
                renderList(idx);
                renderDetail(idx);
                var active = elList.querySelector('.selected-event');
                if (active) active.scrollIntoView({ block: 'nearest' });
            }

            elPrev.addEventListener('click', function() { if (state.current > 0) goTo(state.current - 1); });
            elNext.addEventListener('click', function() { if (state.current < state.events.length - 1) goTo(state.current + 1); });

            document.querySelectorAll('.run-select-btn').forEach(function(btn) {
                btn.addEventListener('click', function() {
                    var slug = btn.dataset.slug;
                    document.querySelectorAll('.run-select-btn').forEach(function(b) {
                        b.style.borderColor = 'var(--border)'; b.style.color = 'var(--dim)';
                    });
                    btn.style.borderColor = 'var(--accent)'; btn.style.color = 'var(--accent)';

                    hide(elEmpty); hide(elPane); hide(elError);
                    show(elLoading);

                    fetch('/api/showcase/' + encodeURIComponent(slug) + '/timeline')
                        .then(function(r) {
                            if (!r.ok) throw new Error('HTTP ' + r.status);
                            return r.json();
                        })
                        .then(function(data) {
                            hide(elLoading);
                            state.events = data.timeline || [];
                            state.current = -1;
                            renderMeta(data.run, data.stats);
                            elList.innerHTML = '';
                            hide(elDetail);
                            elCounter.textContent = '';
                            elPrev.disabled = true;
                            elNext.disabled = state.events.length === 0;
                            show(elPane);
                            if (state.events.length > 0) goTo(0);
                        })
                        .catch(function(err) {
                            hide(elLoading);
                            elError.textContent = 'Failed to load timeline: ' + err.message;
                            show(elError);
                        });
                });
            });
        })();
        </script>

        <!-- Provenance -->
        <section class="mb-14">
            <div class="text-xs text-dim mb-4 uppercase tracking-widest">// provenance — verify the work is real</div>
            <div class="panel p-4 text-xs">
                <div class="text-dim mb-1">
                    REPO: <a href="https://github.com/samuelkahessay/prd-to-prod" class="text-accent hover:underline">github.com/samuelkahessay/prd-to-prod</a>
                </div>
                <div class="text-dim">Every issue, PR, review comment, and merge commit is public. The pipeline's git history is the source of truth.</div>
            </div>
        </section>

        <!-- Get Started -->
        <section class="mb-14">
            <div class="text-xs text-dim mb-4 uppercase tracking-widest">// get started — run the pipeline yourself</div>
            <div class="panel p-6 text-xs">
                <div class="grid sm:grid-cols-2 gap-6">
                    <div>
                        <div class="text-accent font-bold mb-3">four steps to your first autonomous run</div>
                        <ol class="space-y-3 text-dim leading-relaxed list-none">
                            <li><span class="text-accent">01 ·</span> fork <a href="https://github.com/samuelkahessay/prd-to-prod" class="text-accent hover:underline">samuelkahessay/prd-to-prod</a> and clone it locally</li>
                            <li><span class="text-accent">02 ·</span> create <code class="text-white bg-opacity-10 px-1">docs/prd/my-feature.md</code> — describe what you want built, push to <code class="text-white px-1">main</code></li>
                            <li><span class="text-accent">03 ·</span> open an issue linking your PRD, then comment <code class="text-white px-1">/decompose</code> — the decomposer creates implementation issues automatically</li>
                            <li><span class="text-accent">04 ·</span> watch <a href="https://github.com/samuelkahessay/prd-to-prod/actions" class="text-accent hover:underline">GitHub Actions</a> — repo-assist implements issues as PRs, pr-review-agent reviews and merges them</li>
                        </ol>
                    </div>
                    <div>
                        <div class="text-accent font-bold mb-3">useful links</div>
                        <ul class="space-y-2 text-dim">
                            <li>→ <a href="https://github.com/samuelkahessay/prd-to-prod" class="text-accent hover:underline">github.com/samuelkahessay/prd-to-prod</a></li>
                            <li>→ <a href="https://github.com/samuelkahessay/prd-to-prod/blob/main/AGENTS.md" class="text-accent hover:underline">AGENTS.md</a> — coding standards &amp; pipeline conventions</li>
                            <li>→ <a href="https://github.com/samuelkahessay/prd-to-prod/blob/main/docs/prd/ticket-deflection-prd.md" class="text-accent hover:underline">example PRD</a> — the PRD that built this app</li>
                            <li>→ <a href="https://github.com/github/gh-aw" class="text-accent hover:underline">gh-aw</a> — the agentic workflow engine powering this pipeline</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Visual boundary: pipeline story ends, specimen begins -->
        <div class="mb-16" style="border-top: 2px solid var(--border); padding-top: 3rem; position: relative;">
            <div class="text-xs font-bold mb-1 uppercase tracking-widest" style="color: var(--accent)">// specimen — the proof, not the point</div>
            <p class="text-dim text-xs max-w-2xl" style="margin-top: 6px;">
                What follows is the app the pipeline built. It runs. Explore it or ignore it — the pipeline story above is complete either way.
            </p>
        </div>

        <!-- Specimen stats -->
        <section class="mb-10">
            <div class="text-xs text-dim mb-4 uppercase tracking-widest">// ticket deflection service — specimen output</div>
            <div class="panel p-6">
                <h2 class="font-sans text-xl font-bold text-white mb-2">Ticket Deflection Service</h2>
                <p class="text-dim text-xs mb-6 leading-relaxed max-w-xl">
                    A complete C#/.NET application the pipeline built from a single PRD.
                    Classifies, matches, and resolves support tickets through a multi-stage pipeline.
                </p>

                <!-- Stats as instrument panels -->
                <div class="grid grid-cols-3 gap-4 mb-6">
                    <div class="panel panel-top p-4">
                        <div class="metric-val" id="statTickets">25</div>
                        <div class="metric-lbl">tickets processed</div>
                    </div>
                    <div class="panel panel-top p-4">
                        <div class="metric-val" id="statDeflection">--</div>
                        <div class="metric-lbl">deflection rate</div>
                    </div>
                    <div class="panel panel-top p-4">
                        <div class="metric-val">&lt;2s</div>
                        <div class="metric-lbl">processing time</div>
                    </div>
                </div>

                <!-- Ticket pipeline flow -->
                <div class="divider mb-4"></div>
                <div class="text-xs text-dim mb-3">ticket pipeline:</div>
                <div class="flex flex-wrap items-center gap-2 text-xs">
                    <span class="flow-tag">Intake</span>
                    <span class="text-dim">──▶</span>
                    <span class="flow-tag">Classify</span>
                    <span class="text-dim">──▶</span>
                    <span class="flow-tag">Match</span>
                    <span class="text-dim">──▶</span>
                    <span class="flow-tag flow-tag-green">Resolve/Escalate</span>
                </div>
            </div>
        </section>

        <!-- Specimen entry -->
        <section class="mb-16">
            <div class="text-xs text-dim mb-5 uppercase tracking-widest">// enter the specimen</div>
            <div class="panel p-8 text-center">
                <div class="text-xs text-dim mb-6">The dashboard is the specimen. Submit a ticket and watch the pipeline process it in real time.</div>
                <a href="/dashboard" class="exec-btn inline-block" style="text-decoration: none;">[ open dashboard ]</a>
            </div>
        </section>

        <div class="text-center text-dim text-xs mt-12 pb-4">
            Built end-to-end by an autonomous AI pipeline ·
            <a href="https://github.com/samuelkahessay/prd-to-prod" class="hover:text-accent transition-colors">prd-to-prod</a> ·
            <a href="https://github.com/github/gh-aw" class="hover:text-accent transition-colors">gh-aw</a> ·
            <a href="https://github.com/samuelkahessay/prd-to-prod/blob/main/AGENTS.md" class="hover:text-accent transition-colors">AGENTS.md</a> ·
            <a href="https://github.com/samuelkahessay/prd-to-prod/blob/main/LICENSE" class="hover:text-accent transition-colors">MIT License</a>
        </div>

    </div>

    <script>
        // Load live stats from the metrics API
        (async function loadStats() {
            try {
                const res = await fetch('/api/metrics/overview');
                if (!res.ok) return;
                const data = await res.json();
                const ticketEl = document.getElementById('statTickets');
                const deflectionEl = document.getElementById('statDeflection');
                if (ticketEl && data.totalTickets != null) {
                    ticketEl.textContent = data.totalTickets > 0 ? data.totalTickets : '0';
                }
                if (deflectionEl) {
                    deflectionEl.textContent = data.totalTickets > 0
                        ? (data.resolutionRate * 100).toFixed(1) + '%'
                        : '--';
                }
            } catch (_) {
                // Non-critical: silently ignore if API unavailable
            }
        })();
    </script>
</body>
</html>
