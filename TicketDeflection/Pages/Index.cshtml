@page "/"
@model IndexModel
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>prd-to-prod — autonomous software pipeline</title>
    <meta name="description" content="Drop a PRD, get a deployed app. Zero human code. An autonomous GitHub pipeline that decomposes requirements, writes code, reviews its own work, and ships." />
    <!-- OpenGraph -->
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="prd-to-prod" />
    <meta property="og:url" content="https://prd-to-prod.azurewebsites.net" />
    <meta property="og:title" content="prd-to-prod — Drop a PRD. Get a deployed app." />
    <meta property="og:description" content="Autonomous software pipeline: AI decomposes requirements → writes code → reviews PRs → ships to main. Zero human code." />
    <meta property="og:image" content="https://prd-to-prod.azurewebsites.net/og-image.png" />
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="prd-to-prod — Drop a PRD. Get a deployed app." />
    <meta name="twitter:description" content="Autonomous software pipeline: AI decomposes requirements → writes code → reviews PRs → ships to main. Zero human code." />
    <meta name="twitter:image" content="https://prd-to-prod.azurewebsites.net/og-image.png" />
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --bg: #080c12;
            --grid-line: rgba(0, 160, 255, 0.04);
            --border: rgba(0, 160, 255, 0.15);
            --accent: #00aaff;
            --accent-dim: rgba(0, 170, 255, 0.08);
            --green: #3ddc84;
            --amber: #f5a623;
            --red: #f85149;
            --text: #b8c4d4;
            --dim: #4a5a72;
            --mono: 'JetBrains Mono', monospace;
            --sans: 'Space Grotesk', sans-serif;
        }
        * { box-sizing: border-box; }
        body {
            background-color: var(--bg);
            background-image:
                linear-gradient(var(--grid-line) 1px, transparent 1px),
                linear-gradient(90deg, var(--grid-line) 1px, transparent 1px);
            background-size: 48px 48px;
            font-family: var(--mono);
            color: var(--text);
            font-size: 14px;
        }
        h1, h2, h3, .font-sans { font-family: var(--sans); }
        .status-bar {
            background: rgba(0, 170, 255, 0.04);
            border-bottom: 1px solid var(--border);
        }
        .panel {
            background: rgba(4, 10, 20, 0.7);
            border: 1px solid var(--border);
        }
        .panel-top {
            border-top: 2px solid var(--accent);
        }
        .metric-val {
            font-family: var(--mono);
            color: var(--accent);
            font-size: 1.75rem;
            font-weight: 700;
            line-height: 1;
        }
        .metric-lbl {
            color: var(--dim);
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            margin-top: 6px;
        }
        .exec-btn {
            background: transparent;
            border: 1px solid var(--accent);
            color: var(--accent);
            font-family: var(--mono);
            font-size: 1rem;
            font-weight: 700;
            padding: 14px 48px;
            cursor: pointer;
            transition: background 0.2s, box-shadow 0.2s;
            letter-spacing: 0.05em;
        }
        .exec-btn:hover {
            background: var(--accent-dim);
            box-shadow: 0 0 24px rgba(0, 170, 255, 0.2), inset 0 0 20px rgba(0, 170, 255, 0.04);
        }
        .exec-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .stage-label {
            color: var(--dim);
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            width: 60px;
            flex-shrink: 0;
            padding-top: 2px;
        }
        .flow-tag {
            background: rgba(0, 170, 255, 0.08);
            border: 1px solid var(--border);
            color: var(--text);
            font-family: var(--mono);
            font-size: 0.7rem;
            padding: 3px 10px;
            white-space: nowrap;
        }
        .flow-tag-green {
            background: rgba(61, 220, 132, 0.08);
            border: 1px solid rgba(61, 220, 132, 0.2);
            color: var(--green);
        }
        .flow-tag-amber {
            background: rgba(245, 166, 35, 0.08);
            border: 1px solid rgba(245, 166, 35, 0.2);
            color: var(--amber);
        }
        @@keyframes cursor-blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }
        .cursor-blink {
            animation: cursor-blink 1s step-end infinite;
            color: var(--accent);
        }
        .divider { border-top: 1px solid var(--border); margin: 0; }
        .text-accent { color: var(--accent); }
        .text-green { color: var(--green); }
        .text-amber { color: var(--amber); }
        .text-dim { color: var(--dim); }
        .text-white { color: #e8edf5; }
    </style>
</head>
<body class="min-h-screen">

    <!-- Status bar -->
    <div class="status-bar px-6 py-2 flex items-center justify-between text-xs">
        <div class="flex items-center gap-4">
            <span class="text-accent font-bold tracking-widest">PRD-TO-PROD</span>
            <span class="text-dim">//</span>
            <span class="text-dim"><a href="https://github.com/samuelkahessay/prd-to-prod" target="_blank" rel="noopener noreferrer" class="text-dim hover:text-accent transition-colors">samuelkahessay/prd-to-prod</a></span>
        </div>
        <div class="flex items-center gap-2">
            <span class="w-2 h-2 rounded-full bg-[var(--green)] inline-block"></span>
            <span class="text-dim">pipeline: active</span>
        </div>
    </div>

    <div class="max-w-4xl mx-auto px-4 py-14">

        <!-- Hero -->
        <section class="mb-16">
            <div class="text-xs text-dim mb-5">// autonomous software factory — powered by gh-aw</div>
            <h1 class="font-sans text-5xl sm:text-6xl font-bold text-white mb-4 leading-tight">
                Drop a PRD.<br />Get a deployed app.
            </h1>
            <p class="text-dim text-base mb-6">Zero human code.<span class="cursor-blink ml-1">█</span></p>
            <p class="text-sm leading-relaxed max-w-2xl mb-8" style="color: var(--text)">
                <a href="https://github.com/samuelkahessay/prd-to-prod" target="_blank" rel="noopener noreferrer" class="text-accent font-bold hover:underline">prd-to-prod</a> is an autonomous software pipeline powered by
                <a href="https://github.com/github/gh-aw" target="_blank" rel="noopener noreferrer" class="text-accent font-bold hover:underline">gh-aw</a> (GitHub Agentic Workflows).
                It reads a product requirements document, decomposes it into GitHub Issues,
                writes code for each one, opens Pull Requests, reviews its own work, merges to main —
                and self-heals when things break. No human writes a single line of code.
            </p>
            <a href="https://github.com/samuelkahessay/prd-to-prod" target="_blank" rel="noopener noreferrer" class="exec-btn inline-block" style="text-decoration: none; display: inline-block;">[ View on GitHub ]</a>
        </section>

        <!-- Pipeline schematic -->
        <section class="mb-16">
            <div class="text-xs text-dim mb-5 uppercase tracking-widest">// system schematic — prd-to-prod pipeline</div>
            <div class="panel p-6">
                <div class="flex flex-col gap-5">

                    <div class="flex gap-4 items-start">
                        <span class="stage-label">INPUT</span>
                        <div>
                            <div class="text-accent text-xs mb-1">[ product-requirements.md ]</div>
                            <div class="text-dim text-xs leading-relaxed">"Build a ticket deflection service with classification, KB matching, and a live dashboard..."</div>
                        </div>
                    </div>

                    <div class="divider"></div>

                    <div class="flex gap-4 items-start">
                        <span class="stage-label">STAGE 1</span>
                        <div>
                            <div class="text-white font-bold text-sm mb-1">prd-decomposer</div>
                            <div class="text-dim text-xs">Reads PRD → creates GitHub Issues with acceptance criteria and dependency graph</div>
                            <div class="text-green text-xs mt-1">&gt; 13 issues created</div>
                        </div>
                    </div>

                    <div class="flex gap-4 items-start">
                        <span class="stage-label">STAGE 2</span>
                        <div>
                            <div class="text-white font-bold text-sm mb-1">repo-assist</div>
                            <div class="text-dim text-xs">Picks up each issue in dependency order, writes code, opens one draft Pull Request per issue</div>
                            <div class="text-green text-xs mt-1">&gt; 13 PRs opened</div>
                        </div>
                    </div>

                    <div class="flex gap-4 items-start">
                        <span class="stage-label">STAGE 3</span>
                        <div>
                            <div class="text-white font-bold text-sm mb-1">pr-review-agent</div>
                            <div class="text-dim text-xs">Reads full codebase and PR diff, posts verdict — APPROVE or REQUEST_CHANGES with remediation steps</div>
                            <div class="text-green text-xs mt-1">&gt; 13 reviews submitted</div>
                        </div>
                    </div>

                    <div class="flex gap-4 items-start">
                        <span class="stage-label">STAGE 4</span>
                        <div>
                            <div class="text-white font-bold text-sm mb-1">pr-review-submit + auto-merge</div>
                            <div class="text-dim text-xs">On APPROVE: enables auto-merge → PR merges to main → linked issue closes automatically</div>
                            <div class="text-green text-xs mt-1">&gt; 13 PRs merged to main</div>
                        </div>
                    </div>

                    <div class="divider"></div>

                    <div class="flex gap-4 items-start">
                        <span class="stage-label">OUTPUT</span>
                        <div>
                            <div class="text-accent text-xs mb-1">[ production-ready application ]</div>
                            <div class="text-dim text-xs">C#/.NET 10 · ASP.NET Core · Razor Pages · EF Core · xUnit · Dockerfile</div>
                        </div>
                    </div>

                </div>
            </div>
            <div class="mt-3 text-xs text-dim">
                <span class="text-accent">Self-healing:</span> pipeline-watchdog detects stalls, retries failures, cleans up superseded PRs. No human intervention required.
            </div>
        </section>

        <!-- Run History -->
        <section class="mb-16">
            <div class="text-xs text-dim mb-1 uppercase tracking-widest">// build manifest — pipeline run history</div>
            <div class="text-xs font-bold mb-5 text-accent">@Model.TotalRuns runs · @Model.TotalIssues+ issues · @Model.TotalPrs+ PRs · zero human code</div>
            <div class="panel overflow-hidden">
                <!-- Column headers (desktop) -->
                <div class="hidden sm:grid px-4 py-2 text-xs" style="grid-template-columns: 44px 1fr 1fr 60px 60px 72px; border-bottom: 1px solid var(--border); color: var(--dim);">
                    <span>RUN</span>
                    <span>CODENAME</span>
                    <span>STACK</span>
                    <span class="text-right">ISSUES</span>
                    <span class="text-right">PRS</span>
                    <span class="text-right">STATUS</span>
                </div>

                <!-- Run rows — data-driven from IShowcaseService -->
                @if (!Model.CompletedRuns.Any())
                {
                    <div class="px-4 py-6 text-dim text-xs text-center">No completed runs yet.</div>
                }
                else
                {
                    var maxNumber = Model.CompletedRuns.Max(r => r.Number);
                    var descRuns = Model.CompletedRuns.OrderByDescending(r => r.Number).ToList();
                    foreach (var run in descRuns)
                    {
                        var isActive = run.Number == maxNumber;
                        var isLast = run == descRuns[descRuns.Count - 1];
                        var tagUrl = isActive
                            ? "https://github.com/samuelkahessay/prd-to-prod/tree/main"
                            : $"https://github.com/samuelkahessay/prd-to-prod/tree/{run.Tag}";
                        var tagLabel = isActive ? "main" : run.Tag;
                        var borderStyle = isLast ? "" : (isActive
                            ? "border-bottom: 1px solid rgba(0,170,255,0.08);"
                            : "border-bottom: 1px solid var(--border);");
                        var bgStyle = isActive ? "background: rgba(0,170,255,0.03);" : "";
                        var numClass = isActive ? "text-accent font-bold pt-0.5" : "text-dim font-bold pt-0.5";
                        var valClass = isActive ? "text-accent text-right font-bold" : "text-dim text-right";

                        <div class="px-4 py-4" style="@borderStyle@bgStyle">
                            <!-- desktop row -->
                            <div class="hidden sm:grid text-xs items-start" style="grid-template-columns: 44px 1fr 1fr 60px 60px 72px;">
                                <span class="@numClass">@run.Number.ToString("D2")</span>
                                <div>
                                    <div class="text-white font-bold">@run.Name</div>
                                    <div class="text-dim text-xs mt-1">
                                        @if (isActive) { <text>this instance · </text> }
                                        <a href="@tagUrl" class="@(isActive ? "text-accent hover:underline" : "hover:text-accent transition-colors")">@tagLabel</a>
                                    </div>
                                </div>
                                <div class="text-dim leading-relaxed">@run.TechStack</div>
                                <span class="@valClass">@run.IssueCount</span>
                                <span class="@valClass">@run.PrCount</span>
                                <div class="text-right">
                                    @if (isActive) { <span class="text-green font-bold">ACTIVE</span> }
                                    else { <span class="text-dim">merged</span> }
                                </div>
                            </div>
                            <!-- mobile -->
                            <div class="sm:hidden">
                                <div class="flex items-center justify-between mb-1">
                                    <span class="@(isActive ? "text-accent" : "text-dim") font-bold text-xs">RUN @run.Number.ToString("D2")</span>
                                    @if (isActive) { <span class="text-green font-bold text-xs">ACTIVE</span> }
                                    else { <span class="text-dim text-xs">merged</span> }
                                </div>
                                <div class="text-white font-bold text-sm">@run.Name</div>
                                <div class="text-dim text-xs mt-1">@run.TechStack</div>
                                <div class="text-xs mt-1">
                                    <span class="text-dim">@run.IssueCount issues · @run.PrCount PRs</span>
                                    · <a href="@tagUrl" class="@(isActive ? "text-accent hover:underline" : "hover:text-accent transition-colors text-dim")">@tagLabel</a>
                                </div>
                            </div>
                        </div>
                    }
                }
            </div>
            <div class="mt-3 text-xs text-dim">
                Runs 01–03: git tags are the source of truth — inspect the full commit history at each tag link above.
            </div>
        </section>

        <!-- Provenance -->
        <section class="mb-14">
            <div class="text-xs text-dim mb-4 uppercase tracking-widest">// provenance — verify the work is real</div>
            <div class="panel p-4 text-xs">
                <div class="text-dim mb-1">
                    REPO: <a href="https://github.com/samuelkahessay/prd-to-prod" class="text-accent hover:underline">github.com/samuelkahessay/prd-to-prod</a>
                </div>
                <div class="text-dim">Every issue, PR, review comment, and merge commit is public. The pipeline's git history is the source of truth.</div>
            </div>
        </section>

        <!-- Get Started -->
        <section class="mb-14">
            <div class="text-xs text-dim mb-4 uppercase tracking-widest">// get started — run the pipeline yourself</div>
            <div class="panel p-6 text-xs">
                <div class="grid sm:grid-cols-2 gap-6">
                    <div>
                        <div class="text-accent font-bold mb-3">four steps to your first autonomous run</div>
                        <ol class="space-y-3 text-dim leading-relaxed list-none">
                            <li><span class="text-accent">01 ·</span> fork <a href="https://github.com/samuelkahessay/prd-to-prod" class="text-accent hover:underline">samuelkahessay/prd-to-prod</a> and clone it locally</li>
                            <li><span class="text-accent">02 ·</span> create <code class="text-white bg-opacity-10 px-1">docs/prd/my-feature.md</code> — describe what you want built, push to <code class="text-white px-1">main</code></li>
                            <li><span class="text-accent">03 ·</span> open an issue linking your PRD, then comment <code class="text-white px-1">/decompose</code> — the decomposer creates implementation issues automatically</li>
                            <li><span class="text-accent">04 ·</span> watch <a href="https://github.com/samuelkahessay/prd-to-prod/actions" class="text-accent hover:underline">GitHub Actions</a> — repo-assist implements issues as PRs, pr-review-agent reviews and merges them</li>
                        </ol>
                    </div>
                    <div>
                        <div class="text-accent font-bold mb-3">useful links</div>
                        <ul class="space-y-2 text-dim">
                            <li>→ <a href="https://github.com/samuelkahessay/prd-to-prod" class="text-accent hover:underline">github.com/samuelkahessay/prd-to-prod</a></li>
                            <li>→ <a href="https://github.com/samuelkahessay/prd-to-prod/blob/main/AGENTS.md" class="text-accent hover:underline">AGENTS.md</a> — coding standards &amp; pipeline conventions</li>
                            <li>→ <a href="https://github.com/samuelkahessay/prd-to-prod/blob/main/docs/prd/ticket-deflection-prd.md" class="text-accent hover:underline">example PRD</a> — the PRD that built this app</li>
                            <li>→ <a href="https://github.com/github/gh-aw" class="text-accent hover:underline">gh-aw</a> — the agentic workflow engine powering this pipeline</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Visual boundary: pipeline story ends, specimen begins -->
        <div class="mb-16" style="border-top: 2px solid var(--border); padding-top: 3rem; position: relative;">
            <div class="text-xs font-bold mb-1 uppercase tracking-widest" style="color: var(--accent)">// specimen — the proof, not the point</div>
            <p class="text-dim text-xs max-w-2xl" style="margin-top: 6px;">
                What follows is the app the pipeline built. It runs. Explore it or ignore it — the pipeline story above is complete either way.
            </p>
        </div>

        <!-- Specimen stats -->
        <section class="mb-10">
            <div class="text-xs text-dim mb-4 uppercase tracking-widest">// ticket deflection service — specimen output</div>
            <div class="panel p-6">
                <h2 class="font-sans text-xl font-bold text-white mb-2">Ticket Deflection Service</h2>
                <p class="text-dim text-xs mb-6 leading-relaxed max-w-xl">
                    A complete C#/.NET application the pipeline built from a single PRD.
                    Classifies, matches, and resolves support tickets through a multi-stage pipeline.
                </p>

                <!-- Stats as instrument panels -->
                <div class="grid grid-cols-3 gap-4 mb-6">
                    <div class="panel panel-top p-4">
                        <div class="metric-val" id="statTickets">25</div>
                        <div class="metric-lbl">tickets processed</div>
                    </div>
                    <div class="panel panel-top p-4">
                        <div class="metric-val" id="statDeflection">--</div>
                        <div class="metric-lbl">deflection rate</div>
                    </div>
                    <div class="panel panel-top p-4">
                        <div class="metric-val">&lt;2s</div>
                        <div class="metric-lbl">processing time</div>
                    </div>
                </div>

                <!-- Ticket pipeline flow -->
                <div class="divider mb-4"></div>
                <div class="text-xs text-dim mb-3">ticket pipeline:</div>
                <div class="flex flex-wrap items-center gap-2 text-xs">
                    <span class="flow-tag">Intake</span>
                    <span class="text-dim">──▶</span>
                    <span class="flow-tag">Classify</span>
                    <span class="text-dim">──▶</span>
                    <span class="flow-tag">Match</span>
                    <span class="text-dim">──▶</span>
                    <span class="flow-tag flow-tag-green">Resolve/Escalate</span>
                </div>
            </div>
        </section>

        <!-- Specimen entry -->
        <section class="mb-16">
            <div class="text-xs text-dim mb-5 uppercase tracking-widest">// enter the specimen</div>
            <div class="panel p-8 text-center">
                <div class="text-xs text-dim mb-6">The dashboard is the specimen. Submit a ticket and watch the pipeline process it in real time.</div>
                <a href="/dashboard" class="exec-btn inline-block" style="text-decoration: none;">[ open dashboard ]</a>
            </div>
        </section>

        <div class="text-center text-dim text-xs mt-12 pb-4">
            Built end-to-end by an autonomous AI pipeline ·
            <a href="https://github.com/samuelkahessay/prd-to-prod" class="hover:text-accent transition-colors">prd-to-prod</a> ·
            <a href="https://github.com/github/gh-aw" class="hover:text-accent transition-colors">gh-aw</a> ·
            <a href="https://github.com/samuelkahessay/prd-to-prod/blob/main/AGENTS.md" class="hover:text-accent transition-colors">AGENTS.md</a> ·
            <a href="https://github.com/samuelkahessay/prd-to-prod/blob/main/LICENSE" class="hover:text-accent transition-colors">MIT License</a>
        </div>

    </div>

    <script>
        // Load live stats from the metrics API
        (async function loadStats() {
            try {
                const res = await fetch('/api/metrics/overview');
                if (!res.ok) return;
                const data = await res.json();
                const ticketEl = document.getElementById('statTickets');
                const deflectionEl = document.getElementById('statDeflection');
                if (ticketEl && data.totalTickets != null) {
                    ticketEl.textContent = data.totalTickets > 0 ? data.totalTickets : '0';
                }
                if (deflectionEl) {
                    deflectionEl.textContent = data.totalTickets > 0
                        ? (data.resolutionRate * 100).toFixed(1) + '%'
                        : '--';
                }
            } catch (_) {
                // Non-critical: silently ignore if API unavailable
            }
        })();
    </script>
</body>
</html>
