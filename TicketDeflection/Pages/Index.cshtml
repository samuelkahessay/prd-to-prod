@page "/"
@model IndexModel
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>prd-to-prod — autonomous software pipeline</title>
    <meta name="description" content="Drop a PRD, get a deployed app. Zero human code. An autonomous GitHub pipeline that decomposes requirements, writes code, reviews its own work, and ships." />
    <!-- OpenGraph -->
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="prd-to-prod" />
    <meta property="og:url" content="https://ticket-deflection.azurewebsites.net" />
    <meta property="og:title" content="prd-to-prod — Drop a PRD. Get a deployed app." />
    <meta property="og:description" content="Autonomous software pipeline: AI decomposes requirements → writes code → reviews PRs → ships to main. Zero human code." />
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="prd-to-prod — Drop a PRD. Get a deployed app." />
    <meta name="twitter:description" content="Autonomous software pipeline: AI decomposes requirements → writes code → reviews PRs → ships to main. Zero human code." />
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --bg: #080c12;
            --grid-line: rgba(0, 160, 255, 0.04);
            --border: rgba(0, 160, 255, 0.15);
            --accent: #00aaff;
            --accent-dim: rgba(0, 170, 255, 0.08);
            --green: #3ddc84;
            --amber: #f5a623;
            --red: #f85149;
            --text: #b8c4d4;
            --dim: #4a5a72;
            --mono: 'JetBrains Mono', monospace;
            --sans: 'Space Grotesk', sans-serif;
        }
        * { box-sizing: border-box; }
        body {
            background-color: var(--bg);
            background-image:
                linear-gradient(var(--grid-line) 1px, transparent 1px),
                linear-gradient(90deg, var(--grid-line) 1px, transparent 1px);
            background-size: 48px 48px;
            font-family: var(--mono);
            color: var(--text);
            font-size: 14px;
        }
        h1, h2, h3, .font-sans { font-family: var(--sans); }
        .status-bar {
            background: rgba(0, 170, 255, 0.04);
            border-bottom: 1px solid var(--border);
        }
        .panel {
            background: rgba(4, 10, 20, 0.7);
            border: 1px solid var(--border);
        }
        .panel-top {
            border-top: 2px solid var(--accent);
        }
        .metric-val {
            font-family: var(--mono);
            color: var(--accent);
            font-size: 1.75rem;
            font-weight: 700;
            line-height: 1;
        }
        .metric-lbl {
            color: var(--dim);
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            margin-top: 6px;
        }
        .exec-btn {
            background: transparent;
            border: 1px solid var(--accent);
            color: var(--accent);
            font-family: var(--mono);
            font-size: 1rem;
            font-weight: 700;
            padding: 14px 48px;
            cursor: pointer;
            transition: background 0.2s, box-shadow 0.2s;
            letter-spacing: 0.05em;
        }
        .exec-btn:hover {
            background: var(--accent-dim);
            box-shadow: 0 0 24px rgba(0, 170, 255, 0.2), inset 0 0 20px rgba(0, 170, 255, 0.04);
        }
        .exec-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .stage-label {
            color: var(--dim);
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            width: 60px;
            flex-shrink: 0;
            padding-top: 2px;
        }
        .flow-tag {
            background: rgba(0, 170, 255, 0.08);
            border: 1px solid var(--border);
            color: var(--text);
            font-family: var(--mono);
            font-size: 0.7rem;
            padding: 3px 10px;
            white-space: nowrap;
        }
        .flow-tag-green {
            background: rgba(61, 220, 132, 0.08);
            border: 1px solid rgba(61, 220, 132, 0.2);
            color: var(--green);
        }
        .flow-tag-amber {
            background: rgba(245, 166, 35, 0.08);
            border: 1px solid rgba(245, 166, 35, 0.2);
            color: var(--amber);
        }
        @@keyframes cursor-blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }
        .cursor-blink {
            animation: cursor-blink 1s step-end infinite;
            color: var(--accent);
        }
        @@keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .spin { display: inline-block; animation: spin 1s linear infinite; }
        .nav-link {
            display: block;
            text-align: center;
            padding: 14px 16px;
            background: rgba(4, 10, 20, 0.7);
            border: 1px solid var(--border);
            transition: background 0.2s, border-color 0.2s;
            text-decoration: none;
        }
        .nav-link:hover {
            background: var(--accent-dim);
            border-color: var(--accent);
        }
        .nav-link:hover .nav-path { color: var(--accent); }
        .nav-path { color: rgba(0, 170, 255, 0.7); font-weight: 700; margin-bottom: 4px; }
        .nav-desc { color: var(--dim); font-size: 0.65rem; }
        .divider { border-top: 1px solid var(--border); margin: 0; }
        .text-accent { color: var(--accent); }
        .text-green { color: var(--green); }
        .text-amber { color: var(--amber); }
        .text-dim { color: var(--dim); }
        .text-white { color: #e8edf5; }
    </style>
</head>
<body class="min-h-screen">

    <!-- Status bar -->
    <div class="status-bar px-6 py-2 flex items-center justify-between text-xs">
        <div class="flex items-center gap-4">
            <span class="text-accent font-bold tracking-widest">PRD-TO-PROD</span>
            <span class="text-dim">//</span>
            <span class="text-dim"><a href="https://github.com/samuelkahessay/prd-to-prod" target="_blank" rel="noopener noreferrer" class="text-dim hover:text-accent transition-colors">samuelkahessay/prd-to-prod</a></span>
        </div>
        <div class="flex items-center gap-2">
            <span class="w-2 h-2 rounded-full bg-[var(--green)] inline-block"></span>
            <span class="text-dim">pipeline: active</span>
        </div>
    </div>

    <div class="max-w-4xl mx-auto px-4 py-14">

        <!-- Hero -->
        <section class="mb-16">
            <div class="text-xs text-dim mb-5">// autonomous software factory — powered by gh-aw</div>
            <h1 class="font-sans text-5xl sm:text-6xl font-bold text-white mb-4 leading-tight">
                Drop a PRD.<br />Get a deployed app.
            </h1>
            <p class="text-dim text-base mb-6">Zero human code.<span class="cursor-blink ml-1">█</span></p>
            <p class="text-sm leading-relaxed max-w-2xl" style="color: var(--text)">
                <span class="text-accent font-bold">prd-to-prod</span> is an autonomous software pipeline powered by
                <span class="text-accent font-bold">gh-aw</span> (GitHub Agentic Workflows).
                It reads a product requirements document, decomposes it into GitHub Issues,
                writes code for each one, opens Pull Requests, reviews its own work, merges to main —
                and self-heals when things break. No human writes a single line of code.
            </p>
        </section>

        <!-- Pipeline schematic -->
        <section class="mb-16">
            <div class="text-xs text-dim mb-5 uppercase tracking-widest">// system schematic — prd-to-prod pipeline</div>
            <div class="panel p-6">
                <div class="flex flex-col gap-5">

                    <div class="flex gap-4 items-start">
                        <span class="stage-label">INPUT</span>
                        <div>
                            <div class="text-accent text-xs mb-1">[ product-requirements.md ]</div>
                            <div class="text-dim text-xs leading-relaxed">"Build a ticket deflection service with classification, KB matching, and a live dashboard..."</div>
                        </div>
                    </div>

                    <div class="divider"></div>

                    <div class="flex gap-4 items-start">
                        <span class="stage-label">STAGE 1</span>
                        <div>
                            <div class="text-white font-bold text-sm mb-1">prd-decomposer</div>
                            <div class="text-dim text-xs">Reads PRD → creates GitHub Issues with acceptance criteria and dependency graph</div>
                            <div class="text-green text-xs mt-1">&gt; 13 issues created</div>
                        </div>
                    </div>

                    <div class="flex gap-4 items-start">
                        <span class="stage-label">STAGE 2</span>
                        <div>
                            <div class="text-white font-bold text-sm mb-1">repo-assist</div>
                            <div class="text-dim text-xs">Picks up each issue in dependency order, writes code, opens one draft Pull Request per issue</div>
                            <div class="text-green text-xs mt-1">&gt; 13 PRs opened</div>
                        </div>
                    </div>

                    <div class="flex gap-4 items-start">
                        <span class="stage-label">STAGE 3</span>
                        <div>
                            <div class="text-white font-bold text-sm mb-1">pr-review-agent</div>
                            <div class="text-dim text-xs">Reads full codebase and PR diff, posts verdict — APPROVE or REQUEST_CHANGES with remediation steps</div>
                            <div class="text-green text-xs mt-1">&gt; 13 reviews submitted</div>
                        </div>
                    </div>

                    <div class="flex gap-4 items-start">
                        <span class="stage-label">STAGE 4</span>
                        <div>
                            <div class="text-white font-bold text-sm mb-1">pr-review-submit + auto-merge</div>
                            <div class="text-dim text-xs">On APPROVE: enables auto-merge → PR merges to main → linked issue closes automatically</div>
                            <div class="text-green text-xs mt-1">&gt; 13 PRs merged to main</div>
                        </div>
                    </div>

                    <div class="divider"></div>

                    <div class="flex gap-4 items-start">
                        <span class="stage-label">OUTPUT</span>
                        <div>
                            <div class="text-accent text-xs mb-1">[ production-ready application ]</div>
                            <div class="text-dim text-xs">C#/.NET 10 · ASP.NET Core · Razor Pages · EF Core · xUnit · Dockerfile</div>
                        </div>
                    </div>

                </div>
            </div>
            <div class="mt-3 text-xs text-dim">
                <span class="text-accent">Self-healing:</span> pipeline-watchdog detects stalls, retries failures, cleans up superseded PRs. No human intervention required.
            </div>
        </section>

        <!-- Specimen: what the pipeline built -->
        <section class="mb-16">
            <div class="text-xs text-dim mb-5 uppercase tracking-widest">// specimen — what the pipeline built</div>
            <div class="panel p-6">
                <div class="text-xs text-dim mb-4">BUILD_ARTIFACT: ticket-deflection-service · commit b511f76</div>

                <h2 class="font-sans text-xl font-bold text-white mb-2">Ticket Deflection Service</h2>
                <p class="text-dim text-xs mb-6 leading-relaxed max-w-xl">
                    A complete C#/.NET application the pipeline built from a single PRD.
                    Classifies, matches, and resolves support tickets through a multi-stage pipeline.
                    This is the <em>proof</em> — not the point.
                </p>

                <!-- Stats as instrument panels -->
                <div class="grid grid-cols-3 gap-4 mb-6">
                    <div class="panel panel-top p-4">
                        <div class="metric-val">25</div>
                        <div class="metric-lbl">tickets / run</div>
                    </div>
                    <div class="panel panel-top p-4">
                        <div class="metric-val">~70%</div>
                        <div class="metric-lbl">deflection rate</div>
                    </div>
                    <div class="panel panel-top p-4">
                        <div class="metric-val">&lt;2s</div>
                        <div class="metric-lbl">processing time</div>
                    </div>
                </div>

                <!-- Ticket pipeline flow -->
                <div class="divider mb-4"></div>
                <div class="text-xs text-dim mb-3">TICKET_PIPELINE:</div>
                <div class="flex flex-wrap items-center gap-2 text-xs">
                    <span class="flow-tag">Intake</span>
                    <span class="text-dim">──▶</span>
                    <span class="flow-tag">Classify</span>
                    <span class="text-dim">──▶</span>
                    <span class="flow-tag">Match</span>
                    <span class="text-dim">──▶</span>
                    <span class="flow-tag flow-tag-green">Resolve/Escalate</span>
                </div>
            </div>
        </section>

        <!-- Run History -->
        <section class="mb-16">
            <div class="text-xs text-dim mb-1 uppercase tracking-widest">// build manifest — pipeline run history</div>
            <div class="text-xs font-bold mb-5 text-accent">4 runs · 4 apps · 3 tech stacks · 50+ issues · 61+ PRs · zero human code</div>
            <div class="panel overflow-hidden">
                <!-- Column headers (desktop) -->
                <div class="hidden sm:grid px-4 py-2 text-xs" style="grid-template-columns: 44px 1fr 1fr 60px 60px 72px; border-bottom: 1px solid var(--border); color: var(--dim);">
                    <span>RUN</span>
                    <span>CODENAME</span>
                    <span>STACK</span>
                    <span class="text-right">ISSUES</span>
                    <span class="text-right">PRS</span>
                    <span class="text-right">STATUS</span>
                </div>

                <!-- Run 04 — ACTIVE -->
                <div class="px-4 py-4" style="border-bottom: 1px solid rgba(0,170,255,0.08); background: rgba(0,170,255,0.03);">
                    <!-- desktop row -->
                    <div class="hidden sm:grid text-xs items-start" style="grid-template-columns: 44px 1fr 1fr 60px 60px 72px;">
                        <span class="text-accent font-bold pt-0.5">04</span>
                        <div>
                            <div class="text-white font-bold">Ticket Deflection Service</div>
                            <div class="text-dim text-xs mt-1">this instance · <a href="https://github.com/samuelkahessay/prd-to-prod/tree/main" class="text-accent hover:underline">main</a></div>
                        </div>
                        <div class="text-dim leading-relaxed">C# / .NET 10<br />ASP.NET Core / Razor Pages<br />EF Core / xUnit</div>
                        <span class="text-accent text-right font-bold">13</span>
                        <span class="text-accent text-right font-bold">13</span>
                        <div class="text-right"><span class="text-green font-bold">ACTIVE</span></div>
                    </div>
                    <!-- mobile -->
                    <div class="sm:hidden">
                        <div class="flex items-center justify-between mb-1">
                            <span class="text-accent font-bold text-xs">RUN 04</span>
                            <span class="text-green font-bold text-xs">ACTIVE</span>
                        </div>
                        <div class="text-white font-bold text-sm">Ticket Deflection Service</div>
                        <div class="text-dim text-xs mt-1">C# / .NET 10 / ASP.NET Core / EF Core</div>
                        <div class="text-xs mt-1"><span class="text-dim">13 issues · 13 PRs</span> · <a href="https://github.com/samuelkahessay/prd-to-prod/tree/main" class="text-accent hover:underline">main</a></div>
                    </div>
                </div>

                <!-- Run 03 -->
                <div class="px-4 py-4" style="border-bottom: 1px solid var(--border);">
                    <div class="hidden sm:grid text-xs items-start" style="grid-template-columns: 44px 1fr 1fr 60px 60px 72px;">
                        <span class="text-dim font-bold pt-0.5">03</span>
                        <div>
                            <div class="text-white font-bold">DevCard</div>
                            <div class="text-dim text-xs mt-1"><a href="https://github.com/samuelkahessay/prd-to-prod/tree/v3.0.0" class="hover:text-accent transition-colors">v3.0.0</a></div>
                        </div>
                        <div class="text-dim leading-relaxed">Next.js 14 / TypeScript<br />Tailwind CSS / Framer Motion<br />29 tests · 6 themes</div>
                        <span class="text-dim text-right">17</span>
                        <span class="text-dim text-right">22</span>
                        <div class="text-right text-dim">merged</div>
                    </div>
                    <div class="sm:hidden">
                        <div class="flex items-center justify-between mb-1">
                            <span class="text-dim font-bold text-xs">RUN 03</span>
                            <span class="text-dim text-xs">merged</span>
                        </div>
                        <div class="text-white font-bold text-sm">DevCard</div>
                        <div class="text-dim text-xs mt-1">Next.js 14 / TypeScript / Tailwind CSS</div>
                        <div class="text-xs mt-1"><span class="text-dim">17 issues · 22 PRs</span> · <a href="https://github.com/samuelkahessay/prd-to-prod/tree/v3.0.0" class="hover:text-accent transition-colors text-dim">v3.0.0</a></div>
                    </div>
                </div>

                <!-- Run 02 -->
                <div class="px-4 py-4" style="border-bottom: 1px solid var(--border);">
                    <div class="hidden sm:grid text-xs items-start" style="grid-template-columns: 44px 1fr 1fr 60px 60px 72px;">
                        <span class="text-dim font-bold pt-0.5">02</span>
                        <div>
                            <div class="text-white font-bold">Pipeline Observatory</div>
                            <div class="text-dim text-xs mt-1"><a href="https://github.com/samuelkahessay/prd-to-prod/tree/v2.0.0" class="hover:text-accent transition-colors">v2.0.0</a></div>
                        </div>
                        <div class="text-dim leading-relaxed">Next.js 14 / TypeScript<br />Tailwind CSS / Framer Motion<br />32 tests</div>
                        <span class="text-dim text-right">12</span>
                        <span class="text-dim text-right">19</span>
                        <div class="text-right text-dim">merged</div>
                    </div>
                    <div class="sm:hidden">
                        <div class="flex items-center justify-between mb-1">
                            <span class="text-dim font-bold text-xs">RUN 02</span>
                            <span class="text-dim text-xs">merged</span>
                        </div>
                        <div class="text-white font-bold text-sm">Pipeline Observatory</div>
                        <div class="text-dim text-xs mt-1">Next.js 14 / TypeScript / Tailwind CSS</div>
                        <div class="text-xs mt-1"><span class="text-dim">12 issues · 19 PRs</span> · <a href="https://github.com/samuelkahessay/prd-to-prod/tree/v2.0.0" class="hover:text-accent transition-colors text-dim">v2.0.0</a></div>
                    </div>
                </div>

                <!-- Run 01 -->
                <div class="px-4 py-4">
                    <div class="hidden sm:grid text-xs items-start" style="grid-template-columns: 44px 1fr 1fr 60px 60px 72px;">
                        <span class="text-dim font-bold pt-0.5">01</span>
                        <div>
                            <div class="text-white font-bold">Code Snippet Manager</div>
                            <div class="text-dim text-xs mt-1"><a href="https://github.com/samuelkahessay/prd-to-prod/tree/v1.0.0" class="hover:text-accent transition-colors">v1.0.0</a></div>
                        </div>
                        <div class="text-dim leading-relaxed">Express / TypeScript<br />EJS / REST<br />first end-to-end run</div>
                        <span class="text-dim text-right">8</span>
                        <span class="text-dim text-right">7</span>
                        <div class="text-right text-dim">merged</div>
                    </div>
                    <div class="sm:hidden">
                        <div class="flex items-center justify-between mb-1">
                            <span class="text-dim font-bold text-xs">RUN 01</span>
                            <span class="text-dim text-xs">merged</span>
                        </div>
                        <div class="text-white font-bold text-sm">Code Snippet Manager</div>
                        <div class="text-dim text-xs mt-1">Express / TypeScript / EJS</div>
                        <div class="text-xs mt-1"><span class="text-dim">8 issues · 7 PRs</span> · <a href="https://github.com/samuelkahessay/prd-to-prod/tree/v1.0.0" class="hover:text-accent transition-colors text-dim">v1.0.0</a></div>
                    </div>
                </div>
            </div>
            <div class="mt-3 text-xs text-dim">
                Runs 01–03: git tags are the source of truth — inspect the full commit history at each tag link above.
            </div>
        </section>

        <!-- Demo CTA -->
        <section class="mb-16">
            <div class="text-xs text-dim mb-5 uppercase tracking-widest">// live demo — run the pipeline now</div>
            <div class="panel p-8 text-center">
                <div class="text-xs text-dim mb-2">$ exec demo --tickets 25 --redirect /dashboard</div>
                <div class="text-green text-xs mb-8">Process 25 sample tickets through the deflection pipeline.</div>

                <button id="runDemoBtn" onclick="runDemo()" class="exec-btn">
                    <span id="btnText">[ Run Demo ]</span>
                    <span id="btnLoading" class="hidden">
                        <span class="spin">&#x21BB;</span> executing...
                    </span>
                </button>

                <p class="text-dim text-xs mt-5">Generates 25 tickets → redirects to /dashboard on completion</p>

                <div id="demoError" class="hidden mt-5 panel text-left p-4" style="border-color: var(--red)">
                    <div class="text-xs font-bold mb-1" style="color: var(--red)">EXEC_ERROR:</div>
                    <div class="text-xs" style="color: var(--red)" id="demoErrorContent"></div>
                </div>
            </div>
        </section>

        <!-- Provenance -->
        <section class="mb-14">
            <div class="text-xs text-dim mb-4 uppercase tracking-widest">// provenance — verify the work is real</div>
            <div class="panel p-4 text-xs">
                <div class="text-dim mb-1">
                    REPO: <a href="https://github.com/samuelkahessay/prd-to-prod" class="text-accent hover:underline">github.com/samuelkahessay/prd-to-prod</a>
                </div>
                <div class="text-dim">Every issue, PR, review comment, and merge commit is public. The pipeline's git history is the source of truth.</div>
            </div>
        </section>

        <!-- Navigation -->
        <nav>
            <div class="text-xs text-dim mb-4">// explore what the pipeline built</div>
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                <a href="/dashboard" class="nav-link">
                    <div class="nav-path">/dashboard</div>
                    <div class="nav-desc">metrics &amp; resolution rates</div>
                </a>
                <a href="/activity" class="nav-link">
                    <div class="nav-path">/activity</div>
                    <div class="nav-desc">pipeline event log</div>
                </a>
                <a href="/tickets" class="nav-link">
                    <div class="nav-path">/tickets</div>
                    <div class="nav-desc">ticket feed</div>
                </a>
            </div>
        </nav>

        <div class="text-center text-dim text-xs mt-12 pb-4">
            Built end-to-end by an autonomous AI pipeline ·
            <a href="https://github.com/samuelkahessay/prd-to-prod" class="hover:text-accent transition-colors">prd-to-prod</a>
        </div>

    </div>

    <script>
        const DEMO_TIMEOUT_MS = 30000;

        async function runDemo() {
            const btn = document.getElementById('runDemoBtn');
            const btnText = document.getElementById('btnText');
            const btnLoading = document.getElementById('btnLoading');
            const errorDiv = document.getElementById('demoError');
            const errorContent = document.getElementById('demoErrorContent');

            btn.disabled = true;
            btnText.classList.add('hidden');
            btnLoading.classList.remove('hidden');
            errorDiv.classList.add('hidden');

            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), DEMO_TIMEOUT_MS);

            function recover(msg) {
                clearTimeout(timeoutId);
                errorContent.textContent = msg;
                errorDiv.classList.remove('hidden');
                btn.disabled = false;
                btnText.classList.remove('hidden');
                btnLoading.classList.add('hidden');
            }

            try {
                const response = await fetch('/api/simulate?count=25', {
                    method: 'POST',
                    signal: controller.signal
                });
                clearTimeout(timeoutId);
                if (response.ok) {
                    window.location.href = '/dashboard';
                } else {
                    recover('Simulation failed (HTTP ' + response.status + '). Please try again.');
                }
            } catch (err) {
                if (err.name === 'AbortError') {
                    recover('Request timed out after 30 s. The server may be cold-starting — please try again.');
                } else {
                    recover(err.message || 'Network error. Please try again.');
                }
            }
        }
    </script>
</body>
</html>
