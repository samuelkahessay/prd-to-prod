name: Auto-Dispatch Pipeline Issues

on:
  issues:
    types: [opened, reopened, labeled]

jobs:
  dispatch:
    # For 'opened' and 'reopened': fire if issue has 'pipeline' label
    # For 'labeled': fire only when the label being added IS 'pipeline'
    if: >
      (github.event.action == 'opened' || github.event.action == 'reopened') &&
      contains(github.event.issue.labels.*.name, 'pipeline')
      ||
      github.event.action == 'labeled' && github.event.label.name == 'pipeline'
    runs-on: ubuntu-latest
    steps:
      - name: Dispatch repo-assist scheduled mode
        env:
          GH_TOKEN: ${{ secrets.GH_AW_GITHUB_TOKEN }}
        run: |
          gh workflow run repo-assist.lock.yml \
            --repo ${{ github.repository }}
